const http = require('http')
const https = require('https')

const sendHttpRequest = function ({method, hostname, port, path, parameters = {}, data, headers = {}, secure = false}){

  const queryString = Object.keys(parameters).map((key)=>{
    return `${key}=${parameters[key]}`
  }).join('&')

  return new Promise((resolve, reject) => {
    const options = {
      hostname: hostname,
      port: port,
      path: `${path}?${queryString}`
      ,method: method.toUpperCase()
    }

    const httpSender = secure ? https : http

    const req = httpSender.request(options, (res) => {

      res.setEncoding('utf8')
      let responseData = ""
      res.on('data', (chunk) => {
        responseData +=  chunk
      })
      res.on('end', () => {

        resolve(responseData)
      })
    })

    Object.keys(headers).forEach((name) => {
      req.setHeader(name, headers[name])
    })

    req.on('error', (e) => {
      reject(e)
    })

    if(data){
      req.write(JSON.stringify(data))
    }

    req.end()
  })
}

module.exports = sendHttpRequest
